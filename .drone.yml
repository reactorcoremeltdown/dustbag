---
kind: pipeline
type: exec
name: hangar

platform:
  os: linux
  arch: amd64

clone:
  disable: true

steps:
- name: clone
  commands:
  - git clone $DRONE_GIT_SSH_URL
- name: build
  commands:
  - cd $DRONE_REPO_NAME && sudo make production

node:
  machine: hangar.rcmd.space

    # ---
    # kind: pipeline
    # type: exec
    # name: sandbox
    # 
    # platform:
    #   os: linux
    #   arch: amd64
    # 
    # clone:
    #   disable: true
    # 
    # steps:
    # - name: clone
    #   commands:
    #   - git clone $DRONE_GIT_SSH_URL
    # - name: build
    #   commands:
    #   - cd $DRONE_REPO_NAME && sudo make seedbox
    # 
    # node:
    #   machine: kind-box

---
kind: pipeline
type: exec
name: fermium

platform:
  os: linux
  arch: arm

clone:
  disable: true

steps:
- name: clone
  commands:
  - git clone --depth 1 $DRONE_GIT_SSH_URL
- name: build
  commands:
  - cd $DRONE_REPO_NAME && sudo make fermium

node:
  machine: fermium

---
kind: pipeline
type: exec
name: printserver

platform:
  os: linux
  arch: arm

clone:
  disable: true

steps:
- name: clone
  commands:
  - git clone --depth 1 $DRONE_GIT_SSH_URL
- name: build
  commands:
  - cd $DRONE_REPO_NAME && sudo make printserver

node:
  machine: orangepizero

---
kind: pipeline
type: exec
name: report

platform:
  os: linux
  arch: amd64

clone:
  disable: true

steps:
- name: report
  commands:
  - /usr/local/bin/telegram.run

trigger:
  status:
  - success
  - failure

node:
  machine: hangar.rcmd.space

depends_on:
- hangar
- fermium
# - sandbox
- printserver
